@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Импорт контрагентов из файла</h3>
<div>
    <form role="form" class="form-horizontal">
        <div class="form-group">
            <label class="control-label col-md-2" for="uploadFile">Укажите путь к файлу</label>
            <div class="col-md-10">
                <input type="file" class="form-control" id="uploadFile" accept="text/plain"/>
            </div>
        </div>
        <button type ="button" class ="btn btn-primary pull-right" id="submit">Загрузить</button>
    </form>
</div>

@section scripts{
    <script type="text/javascript">

    $('#submit').on('click', function (e) {
        e.preventDefault();
        if (document.getElementById('uploadFile').value != '')
        {
            var files = document.getElementById('uploadFile').files;
            if (files != undefined && files.length > 0)
            {
                if (window.FormData != undefined)
                {
                    var data = new FormData();
                    for (var x = 0; x < files.length; x++)
                    {
                        data.append("file" + x, files[x]);
                    }

                    $.ajax({
                        type: "POST",
                        url: '/api/import',
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (result) {
                            alert(result);
                        },
                        error: function (xhr, status, p3) {
                            alert(xhr.responseText);
                        }
                    });
                }
                else
                {
                    alert("Извините, Ваш браузер не поддерживает загрузку файлов");
                }
            }
            else
            {
                alert("Извините, Ваш браузер не поддерживает загрузку файлов");
            }
        }
        else
        {
            alert("Пожалуйста, предварительно укажите путь к файлу");
        }
        
    });
    </script>
}